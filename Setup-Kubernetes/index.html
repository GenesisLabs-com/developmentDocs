



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Setup-Kubernetes - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.0284f74d.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#up-a-kubernetes-cluster-on-aws-in-5-minutes" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="My Docs" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              My Docs
            </span>
            <span class="md-header-nav__topic">
              
                Setup-Kubernetes
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="My Docs" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="welcome" class="md-nav__link">
      welcome
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../sdkconfigration/" title="sdk" class="md-nav__link">
      sdk
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../coin&address/" title="coin" class="md-nav__link">
      coin
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="Setup-Kubernetes" class="md-nav__link md-nav__link--active">
      Setup-Kubernetes
    </a>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../npm-packages/" title="npm-packages" class="md-nav__link">
      npm-packages
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../explorer-k8s-deployment/" title="explorer-k8s-deployment" class="md-nav__link">
      explorer-k8s-deployment
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../nginx.deployment.k8s/" title="nginx.deployment.k8s" class="md-nav__link">
      nginx.deployment.k8s
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../color-wallet/" title="color-wallet" class="md-nav__link">
      color-wallet
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../docker-healthcheck/" title="docker-healthcheck" class="md-nav__link">
      docker-healthcheck
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../meteor/" title="meteor" class="md-nav__link">
      meteor
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="up-a-kubernetes-cluster-on-aws-in-5-minutes">Up a Kubernetes Cluster on AWS in 5 Minutes</h1>
<p><a href="https://kubernetes.io/">Kubernetes</a> is like magic. It is a system for working with containerized applications: deployment, scaling, management, service discovery, magic. Think Docker at scale with little hassle. Despite the power of Kubernetes though, I find the <a href="https://github.com/kubernetes/kops/blob/master/docs/aws.md">official guide</a> for setting up Kubernetes on AWS a bit overwhelming, so I wrote a simpler version to get started.</p>
<p>As a side note, AWS introduced a new serviced called A <a href="https://aws.amazon.com/eks/"><strong>mazon Elastic Container Service for Kubernetes</strong></a> – EKS for short. But it’s still in Preview mode.</p>
<p>Before we begin, here’s a YouTube video demonstrating how to set up a Kubernetes Cluster on AWS following the instructions below:</p>
<h1 id="prerequisites">Prerequisites</h1>
<p>Before setting up the Kubernetes cluster, you’ll need an <a href="https://aws.amazon.com/account/">AWS account</a> and an installation of the <a href="https://aws.amazon.com/cli/">AWS Command Line Interface</a>.</p>
<p>Make sure to configure the AWS CLI to use your access key ID and secret access key:</p>
<pre><code>aws configure
AWS Access Key ID [None]: your aws access key
AWS Secret Access Key [None]: your aws secret key
Default region name [None]: us-east-1
Default output format [None]:

</code></pre>

<p>Installing kops + kubectl
Now, to get started, let’s install two Kubernetes CLI utilities:</p>
<ol>
<li><a href="https://github.com/kubernetes/kops">Kubernetes Operations, kops</a></li>
<li><a href="https://kubernetes.io/docs/reference/kubectl/overview/">Kubernetes command-line tool, kubectl</a></li>
</ol>
<p>On Mac OS X, we’ll use <a href="https://brew.sh/">brew</a> to install. If you’re on Linux, see the official <a href="https://github.com/kubernetes/kops#installing">Kops</a> installation guide.</p>
<h1 id="setting-up-the-kubernetes-cluster">Setting Up the Kubernetes Cluster</h1>
<p>Easy enough. Now, let’s set up the Kubernetes cluster.</p>
<p>The first thing we need to do is create an S3 bucket for kops to use to store the state of the Kubernetes cluster and its configuration. We’ll use the bucket name colors-kops-state-store.</p>
<pre><code>$ aws s3api create-bucket --bucket colors-kops-state-store --region us-east-2 --create-bucket-configuration LocationConstraint=us-east-2

</code></pre>

<p>After creating the colors-kops-state-store bucket, let’s enable versioning to revert or recover a previous state store.</p>
<pre><code>$ aws s3api put-bucket-versioning --bucket colors-kops-state-store  --versioning-configuration Status=Enabled

</code></pre>

<p>Before creating the cluster, let’s set two environment variables: KOPS_CLUSTER_NAME and <strong>KOPS_STATE_STORE. </strong>For safe keeping you should add the following to your <strong>~/.bash_profile </strong> or ~/.bashrc configs (or whatever the equivalent is if you don’t use bash).</p>
<p>export KOPS_CLUSTER_NAME=colors.k8s.local
export KOPS_STATE_STORE=s3://colors-kops-state-store</p>
<p>kops export kubecfg --state s3://colors-kops-state-store --name=colors.k8s.local</p>
<p>You don’t HAVE TO set the environment variables, but they are useful and referenced by <strong>kops</strong> commands. For example, see <code>kops create cluster --help</code>. If the the Kubernetes cluster name ends with k8s.local, Kubernetes will create a gossip-based cluster.</p>
<p>Now, to generate the cluster configuration:</p>
<pre><code>$ kops create cluster --node-count=1 --node-size=t2.medium --zones=us-east-2b 
</code></pre>

<p>Note: this line doesn’t launch the AWS EC2 instances. It simply creates the configuration and writes to the s3://colors-kops-state-store bucket we created above. In our example, we’re creating 2 t2.medium EC2 work nodes in addition to a c4.large master instance (default).</p>
<pre><code>$ kops edit cluster
</code></pre>

<p>Alternatively, you can name the cluster by appending --name to the command:</p>
<pre><code>$ kops create cluster --node-count=1 --node-size=t2.medium --zones=us-east-1a --name chubby-bunnies
</code></pre>

<p>Now that we’ve generated a cluster configuration, we can edit its description before launching the instances. The config is loaded from s3://colors-kops-state-store. You can change the editor used to edit the config by setting $EDITOR or $KUBE_EDITOR. For instance, in my ~/.bashrc, I have export KUBE_EDITOR=emacs.</p>
<p>Time to build the cluster. This takes a few minutes to boot the EC2 instances and download the Kubernetes components.</p>
<p>kops update cluster --name ${KOPS_CLUSTER_NAME} --yes
After waiting a bit, let’s validate the cluster to ensure the master + 2 nodes have launched.</p>
<p>$ kops validate cluster
Validating cluster colors.k8s.local</p>
<p>INSTANCE GROUPS</p>
<p>NAME            ROLE    MACHINETYPE MIN MAX SUBNETS</p>
<p>master-us-east-1a   Master  c4.large    1   1   us-east-1a
nodes           Node    t2.medium   2   2   us-east-1a</p>
<p>NODE STATUS
NAME                ROLE    READY
ip-172-20-34-111.ec2.internal   node    True
ip-172-20-40-24.ec2.internal    master  True
ip-172-20-62-139.ec2.internal   node    True
Note: If you ignore the message Cluster is starting. It should be ready in a few minutes. and validate too early, you’ll get an error. Wait a little longer for the nodes to launch, and the validate step will return without error.</p>
<p>$ kops validate cluster
Validating cluster colors.k8s.local</p>
<p>unexpected error during validation: error listing nodes: Get https://api-colors-k8s-local-71cb48-202595039.us-east-1.elb.amazonaws.com/api/v1/nodes: EOF
Finally, you can see your Kubernetes nodes with kubectl:</p>
<p>$ kubectl get nodes
NAME                            STATUS    ROLES     AGE       VERSION
ip-172-20-34-111.ec2.internal   Ready     node      2h        v1.9.3
ip-172-20-40-24.ec2.internal    Ready     master    2h        v1.9.3
ip-172-20-62-139.ec2.internal   Ready     node      2h        v1.9.3</p>
<h1 id="kubernetes-dashboard">Kubernetes Dashboard</h1>
<p>Excellent. We have a working Kubernetes cluster deployed on AWS. At this point, we can deploy lots of things, such as Dask and Jupyter. For demonstration, we’ll launch the Kubernetes Dashboard. Think UI instead of command line for managing Kubernetes clusters and applications.</p>
<p>Here’s a YouTube video illustrating how to install the Kubernetes Dashboard:</p>
<pre><code>
kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml

secret &quot;kubernetes-dashboard-certs&quot; created
serviceaccount &quot;kubernetes-dashboard&quot; created
role.rbac.authorization.k8s.io &quot;kubernetes-dashboard-minimal&quot; created
rolebinding.rbac.authorization.k8s.io &quot;kubernetes-dashboard-minimal&quot; created
deployment.apps &quot;kubernetes-dashboard&quot; created
service &quot;kubernetes-dashboard&quot; created

</code></pre>

<p>You can see that various items were created, including the kubernetes-dashboard service and app.</p>
<p>If the dashboard was created, how do we view it? Easy. Let’s get the AWS hostname:</p>
<pre><code>$ kubectl cluster-info

Kubernetes master is running at https://api-ramhiser-k8s-local-71cb48-202595039.us-east-1.elb.amazonaws.com
KubeDNS is running at https://api-ramhiser-k8s-local-71cb48-202595039.us-east-1.elb.amazonaws.com/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.

</code></pre>

<p>With this hostname, open your browser to https://api-ramhiser-k8s-local-71cb48-202595039.us-east-1.elb.amazonaws.com/ui. (You’ll need to replace the hostname with yours).</p>
<p>Alternatively, you can access the Dashboard UI via a proxy:</p>
<pre><code> kubectl proxy

Starting to serve on 127.0.0.1:8001
</code></pre>

<p>https://api-colors-k8s-local-inoltk-1851277883.us-east-2.elb.amazonaws.com/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/login</p>
<p>login password nyY0Wm0ocm63cea1TnkA9G0cZkD3vEkd
admin token  XPjiuCWjRGM7ScVbmIoWtUU3ljsHnt04</p>
<h1 id="adding-team-member-is-kubernetes-project">Adding team member is kubernetes project</h1>
<pre><code>https://itnext.io/let-you-team-members-use-kubernetes-bf2ebd0be717
</code></pre>

<p>helmins() {
 kubectl -n kube-system create serviceaccount tiller
 kubectl create clusterrolebinding tiller --clusterrole cluster-admin --serviceaccount=kube-system:tiller
 helm init --service-account=tiller
}
helmdel() {
 kubectl -n kube-system delete deployment tiller-deploy
 kubectl delete clusterrolebinding tiller
 kubectl -n kube-system delete serviceaccount tiller</p>
<p>}</p>
<p>kubectl port-forward nonexistent-labradoodle-colors-helm-7cf6d7f88d-66dh5 8080:80</p>
<p>to get passs</p>
<p>kops get secrets kube --type secret -oplaintext</p>
<p>to get token 
kops get secrets admin --type secret -oplaintext</p>
<h2 id="to-use-kubectl-in-insecure-mod">To use kubectl in insecure mod</h2>
<pre><code>kubectl --insecure-skip-tls-verify --context=colors.k8s.local get nodes

</code></pre>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../coin&address/" title="coin" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                coin
              </span>
            </div>
          </a>
        
        
          <a href="../npm-packages/" title="npm-packages" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                npm-packages
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>